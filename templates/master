<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
	<script src="{{ url_for('static', filename='js/jquery-3.3.1.min.js') }}" type="text/javascript"></script>
	<script src="{{ url_for('static', filename='js/popper.min.js') }}" type="text/javascript"></script>
	<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}" type="text/javascript"></script>
	<script src="{{ url_for('static', filename='js/angular.min.js') }}" type="text/javascript"></script>
	<title>Mail Archive Viewer</title>
</head>
<body>
	<div id="content" class="container" ng-app="mailApp" ng-controller="mailCtrl">
		<div id="head" class="row">
			<div class="col">
				<h1>Meow!</h1>
			</div>
		</div>
		<div id="main" class="row">
			<div id="mailboxes" class="col-md-2">
				<h3>Mailboxes</h3>
				<ul class="list-group">
					<li class="list-group-item" ng-click="boxClick($event, box)" ng-repeat="box in mailboxes">
						{ng box ng}
					</li>
				</ul>
			</div>
			<div id="messages" class="col">
				<table>
					<thead>
						<tr>
							<td>From</td>
							<td>Subject</td>
						</tr>
					</thead>
					<tbody>
						<tr ng-repeat="msg in messages">
							<td>{ng msg.From ng}</td>
							<td>{ng msg.Subject ng}</td>
						</tr>
					</tbody>
				</table>
			</div>
		</div>
	</div>
	<script type="text/javascript">
		var app = angular.module('mailApp', []);

		// Make angular play nice with jinja
		app.config(['$interpolateProvider', function($interpolateProvider) {
			$interpolateProvider.startSymbol('{ng');
			$interpolateProvider.endSymbol('ng}');
		}]);

		app.controller("mailCtrl", function($scope, $http) {
			// Initialize message list empty
			$scope.messages = [];

			// Initialize mailbox list from database
			$http.get("/api/mailboxes")
			.then(function(response) {
				$scope.mailboxes = response.data;
			});

			// Handle clicking on a mailbox
			$scope.boxClick = function($event, mailbox) {
				$event.currentTarget.class = $event.currentTarget.class + " active";
				$http.get("/api/someMessages/" + mailbox)
				.then(function(response) {
					$scope.messages = response.data;
				});
			}
		})
	</script>
</body>

</html>